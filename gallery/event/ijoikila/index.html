<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FyLinx Gallery</title>

<style>
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#fff;
  color:#111;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:5;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-bottom:1px solid #eee;
  background:#fff;
}

header h1{font-size:14px;margin:0}
header span{font-size:12px;color:#777}

/* GALLERY */
.gallery{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:4px;
  padding:6px;
}

@media(min-width:600px){
  .gallery{grid-template-columns:repeat(4,1fr)}
}
@media(min-width:1024px){
  .gallery{grid-template-columns:repeat(6,1fr)}
}

.gallery img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:4px;
  cursor:pointer;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:20;
}

.modal img{
  max-width:95vw;
  max-height:95vh;
  object-fit:contain;
}

.modal-close{
  position:absolute;
  top:14px;
  right:16px;
  font-size:26px;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <h1>FyLinx</h1>
  <span>Ijoy & Kila</span>
</header>

<div class="gallery" id="gallery"></div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-close" id="modalClose">âœ•</div>
  <img id="modalImg">
</div>

<script>
const API_KEY = "AIzaSyCyL4jxLN9w87WG20GqeEIAaUCupjKmn8U";
const FOLDER_ID = "1qEfxwXgPcvEPRlBKNNecsHaqFSRrAjTE";
const PAGE_SIZE = 24;

const gallery = document.getElementById("gallery");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");
const modalClose = document.getElementById("modalClose");

let nextPageToken = null;
let loading = false;
let finished = false;

/* LOAD IMAGES */
async function loadNextImages(){
  if(loading || finished) return;
  loading = true;

  const query = encodeURIComponent(
    `'${FOLDER_ID}' in parents and mimeType contains 'image/'`
  );

  let url =
    `https://www.googleapis.com/drive/v3/files?q=${query}` +
    `&orderBy=name desc&pageSize=${PAGE_SIZE}` +
    `&fields=nextPageToken,files(id)` +
    `&key=${API_KEY}`;

  if(nextPageToken) url += `&pageToken=${nextPageToken}`;

  const res = await fetch(url);
  const data = await res.json();

  nextPageToken = data.nextPageToken || null;
  if(!nextPageToken) finished = true;

  data.files.forEach(file=>{
    const img = document.createElement("img");
    img.src = `https://drive.google.com/thumbnail?id=${file.id}&sz=w500`;
    img.onclick = ()=>openModal(file.id);
    gallery.appendChild(img);
  });

  loading = false;
}

/* SCROLL INFINITE LOAD */
window.addEventListener("scroll",()=>{
  const scrollBottom =
    window.innerHeight + window.scrollY >=
    document.body.offsetHeight - 800;

  if(scrollBottom){
    loadNextImages();
  }
});

/* MODAL */
function openModal(id){
  modalImg.src = `https://lh3.googleusercontent.com/d/${id}`;
  modal.style.display = "flex";
}

function closeModal(){
  modal.style.display = "none";
  modalImg.src = "";
}

modalClose.onclick = closeModal;
modal.addEventListener("click",e=>{
  if(e.target === modal) closeModal();
});

/* INIT */
loadNextImages();
</script>

</body>
</html>
