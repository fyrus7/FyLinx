<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FyLinx Gallery</title>

<style>
/* ===== GLOBAL SCROLL FIX ===== */
html, body{
  min-height:101vh;
}

body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#fff;
  color:#111;
}

/* ===== HEADER ===== */
header{
  position:sticky;
  top:0;
  z-index:5;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  border-bottom:1px solid #eee;
  background:#fff;
}
header h1{font-size:14px;margin:0}
header span{font-size:12px;color:#777}

/* ===== GALLERY ===== */
.gallery{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:4px;
  padding:6px;

  /* CRITICAL */
  min-height:calc(100vh - 60px);
}

@media(min-width:600px){.gallery{grid-template-columns:repeat(4,1fr)}}
@media(min-width:1024px){.gallery{grid-template-columns:repeat(6,1fr)}}

.gallery img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:4px;
  cursor:pointer;
}

/* ===== SENTINEL ===== */
#sentinel{
  grid-column:1/-1;
  height:1px;

  /* CRITICAL */
  margin-bottom:40vh;
}

/* ===== MODAL (UNCHANGED, WORKING) ===== */
.modal{
  position:fixed;
  inset:0;
  display:none;
  z-index:20;
}

.modal-backdrop{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.92);
}

.modal-content{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  pointer-events:none;
}

.modal-content img{
  max-width:96vw;
  max-height:90vh;
  object-fit:contain;
  pointer-events:auto;
}

body.modal-open{
  overflow:hidden;
}
</style>
</head>

<body>

<header>
  <h1>FyLinx</h1>
  <span>Ijoy & Kila</span>
</header>

<div class="gallery" id="gallery">
  <div id="sentinel"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-backdrop" id="modalBackdrop"></div>
  <div class="modal-content">
    <img id="modalImg">
  </div>
</div>

<script>
const API_KEY="AIzaSyCyL4jxLN9w87WG20GqeEIAaUCupjKmn8U";
const FOLDER_ID="1qEfxwXgPcvEPRlBKNNecsHaqFSRrAjTE";
const PAGE_SIZE=24;

const gallery=document.getElementById("gallery");
const sentinel=document.getElementById("sentinel");

const modal=document.getElementById("modal");
const modalBackdrop=document.getElementById("modalBackdrop");
const modalImg=document.getElementById("modalImg");

let nextPageToken=null;
let loading=false;

/* ===== LOAD ===== */
async function loadNextImages(){
  if(loading) return;
  loading=true;

  const q=encodeURIComponent(`'${FOLDER_ID}' in parents and mimeType contains 'image/'`);
  let url=`https://www.googleapis.com/drive/v3/files?q=${q}&orderBy=name desc&pageSize=${PAGE_SIZE}&fields=nextPageToken,files(id)&key=${API_KEY}`;
  if(nextPageToken) url+=`&pageToken=${nextPageToken}`;

  const res=await fetch(url);
  const data=await res.json();
  nextPageToken=data.nextPageToken||null;

  data.files.forEach(file=>{
    const img=document.createElement("img");
    img.src=`https://drive.google.com/thumbnail?id=${file.id}&sz=w500`;
    img.onclick=()=>openModal(file.id);
    gallery.insertBefore(img,sentinel);
  });

  loading=false;
}

/* ===== MODAL ===== */
function openModal(id){
  modalImg.src=`https://lh3.googleusercontent.com/d/${id}`;
  modal.style.display="block";
  document.body.classList.add("modal-open");
}

function closeModal(){
  modal.style.display="none";
  modalImg.src="";
  document.body.classList.remove("modal-open");
}

modalBackdrop.onclick=closeModal;

/* ===== INFINITE SCROLL ===== */
new IntersectionObserver(e=>{
  if(e[0].isIntersecting && nextPageToken){
    loadNextImages();
  }
},{rootMargin:"300px"}).observe(sentinel);

loadNextImages();
</script>

</body>
</html>
