<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FyLinx Gallery</title>

<style>
/* RESET */
*{
  box-sizing:border-box;
  margin:0;
  padding:0;
}

html, body{
  width:100%;
  height:auto; /* ‚ùóJANGAN 100vh */
  overflow-x:hidden;
  overflow-y:auto; /* scroll hanya body */
  font-family:system-ui,sans-serif;
  background:#fff;
}

/* HEADER */
header{
  padding:16px;
  font-size:20px;
  font-weight:600;
  border-bottom:1px solid #eee;
}

/* GALLERY GRID */
.gallery{
  display:grid;
  grid-template-columns:repeat(auto-fill, minmax(180px,1fr));
  gap:6px;
  padding:6px;
}

/* THUMBNAIL */
.gallery img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  display:block;
  cursor:pointer;
}

/* SENTINEL */
#sentinel{
  grid-column:1/-1;
  height:1px;
  margin-bottom:40vh; /* pastikan scrollable awal */
}

/* MODAL SINGLE IMAGE */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.modal img{
  max-width:96vw;
  max-height:90vh;
  object-fit:contain;
}
</style>
</head>

<body>

<header>FyLinx Gallery</header>

<main>
  <div class="gallery" id="gallery">
    <div id="sentinel"></div>
  </div>
</main>

<div class="modal" id="modal">
  <img id="modalImg">
</div>

<script>
const API_KEY="AIzaSyCyL4jxLN9w87WG20GqeEIAaUCupjKmn8U"; // ganti API key sebenar
const FOLDER_ID="1qEfxwXgPcvEPRlBKNNecsHaqFSRrAjTE";  // ganti folder ID sebenar
const PAGE_SIZE=24;

const gallery = document.getElementById("gallery");
const sentinel = document.getElementById("sentinel");
const modal = document.getElementById("modal");
const modalImg = document.getElementById("modalImg");

let nextPageToken = null;
let loading = false;
let imageIds = [];

/* ===== LOAD IMAGES ===== */
async function loadNextImages(){
  if(loading) return;
  loading = true;

  const query = encodeURIComponent(`'${FOLDER_ID}' in parents and mimeType contains 'image/'`);
  let url = `https://www.googleapis.com/drive/v3/files?q=${query}&orderBy=name desc&pageSize=${PAGE_SIZE}&fields=nextPageToken,files(id)&key=${API_KEY}`;
  if(nextPageToken) url += `&pageToken=${nextPageToken}`;

  const res = await fetch(url);
  const data = await res.json();
  nextPageToken = data.nextPageToken || null;

  data.files.forEach(file => {
    imageIds.push(file.id);
    const img = document.createElement("img");
    img.src = `https://drive.google.com/thumbnail?id=${file.id}&sz=w500`;
    img.loading = "lazy";
    img.onclick = () => openModal(file.id);
    gallery.insertBefore(img, sentinel);
  });

  loading = false;

  /* pastikan scrollable desktop awal */
  if(nextPageToken && document.documentElement.scrollHeight <= window.innerHeight + 50){
    loadNextImages();
  }
}

/* ===== MODAL SINGLE IMAGE ===== */
function openModal(id){
  modalImg.src = `https://lh3.googleusercontent.com/d/${id}`;
  modal.style.display = "flex";
  document.body.style.overflow = "hidden"; // lock scroll
}

function closeModal(){
  modal.style.display = "none";
  modalImg.src = "";
  document.body.style.overflow = "auto"; // restore scroll
}

modal.addEventListener("click", closeModal);
window.addEventListener("keydown", e => {
  if(e.key === "Escape" && modal.style.display === "flex") closeModal();
});

/* ===== INFINITE SCROLL ===== */
new IntersectionObserver(entries=>{
  if(entries[0].isIntersecting && nextPageToken){
    loadNextImages();
  }
},{rootMargin:"400px"}).observe(sentinel);

/* INITIAL LOAD */
loadNextImages();
</script>

</body>
</html>
